<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Vyamir | Monsoon Watch</title>
    <link rel="icon" type="image/png" href="/logo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <meta name="description"
        content="Vyamir Monsoon Watch: Live tracking, onset dates, and regional rainfall deficit statistics for India.">
    <script id="vyamir-config" type="application/json">
        {{ config | tojson | safe }}
    </script>
    <script>
        window.VYAMIR_CONFIG = JSON.parse(document.getElementById('vyamir-config').textContent);
        window.VYAMIR_SKIP_WELCOME = true;
    </script>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: window.VYAMIR_CONFIG.FIREBASE_API_KEY,
            authDomain: "vyamir-0156.firebaseapp.com",
            projectId: "vyamir-0156",
            storageBucket: "vyamir-0156.firebasestorage.app",
            messagingSenderId: "587528291042",
            appId: "1:587528291042:web:7ef286fc28ae3863b1d4bb",
            measurementId: "G-ML1DF6JGM8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.db = db;

        (async () => {
            try {
                setTimeout(() => {
                    const overlay = document.getElementById('session-restoration-overlay');
                    if (overlay) { overlay.style.opacity = '0'; setTimeout(() => overlay.remove(), 500); }
                }, 4000);
                await setPersistence(auth, browserLocalPersistence);
                onAuthStateChanged(auth, (user) => {
                    const overlay = document.getElementById('session-restoration-overlay');
                    if (user) {
                        const syncWait = setInterval(() => {
                            if (window.vyamirSessionRestored || window.vyamirNeedsConsent) {
                                clearInterval(syncWait);
                                setTimeout(() => { if (overlay) overlay.style.opacity = '0'; setTimeout(() => overlay?.remove(), 500); }, 300);
                            }
                        }, 50);
                    } else {
                        signInAnonymously(auth).catch(console.error);
                    }
                });
            } catch (error) { console.error(error); }
        })();
    </script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6959399778170612"
        crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/navigation/part-sidebar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/weather/part-details.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="is-dashboard bg-rain">
    <div id="session-restoration-overlay"
        style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0b0e14; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease; pointer-events: none;">
        <img src="/static/img/logo.png" alt="Vyamir"
            style="width: 80px; height: 80px; margin-bottom: 25px; filter: drop-shadow(0 0 15px rgba(88,166,255,0.4));">
        <div class="loader-spinner"
            style="width: 30px; height: 30px; border: 2px solid rgba(88, 166, 255, 0.1); border-top-color: #58a6ff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 15px;">
        </div>
        <div
            style="color: rgba(255,255,255,0.7); font-family: 'Inter', sans-serif; font-size: 0.8rem; letter-spacing: 2px;">
            CALIBRATING MONSOON SATELLITES...</div>
    </div>
    <style>
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>

    <div id="toast-container" class="toast-container"></div>


    <div class="container">
        {% include 'components/navigation/part_header.html' %}

        <!-- Monsoon Tracking Grid -->
        <div class="grid-container" style="display: block;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="color: white; margin: 0; font-weight: 300; display: flex; align-items: center; gap: 10px;">
                    <i class="bi bi-cloud-rain-heavy" style="color: #4fc3f7;"></i> Indian Monsoon Watch
                </h2>
                <div
                    style="background: rgba(255,255,255,0.1); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">
                    Status: <span style="color: #69f0ae;">Active</span> (Season 2025)
                </div>
            </div>

            <div class="row" style="display: flex; gap: 20px; flex-wrap: wrap;">
                <!-- Onset Map Container -->
                <div class="glass-panel"
                    style="flex: 2; min-width: 400px; height: 500px; padding: 0; overflow: hidden; position: relative; border-radius: 20px;">
                    <div id="monsoon-map" style="width: 100%; height: 100%;"></div>
                    <div
                        style="position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); padding: 10px 15px; border-radius: 12px; z-index: 1000; pointer-events: none; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.1);">
                        <div style="color: #4fc3f7; font-weight: 600; font-size: 0.9rem;">LIVE PRECIPITATION FLUX</div>
                        <div style="color: rgba(255,255,255,0.6); font-size: 0.75rem; margin-top: 2px;">RainViewer Radar
                            Overlay</div>
                    </div>
                </div>

                <!-- Statistics Column -->
                <div style="flex: 1; min-width: 300px; display: flex; flex-direction: column; gap: 20px;">
                    <div class="glass-panel" style="padding: 25px;">
                        <h4 style="margin: 0 0 10px 0; color: #b3e5fc; font-weight: 400;">Rainfall Departure</h4>
                        <div style="font-size: 3rem; font-weight: 700; color: white;">+4%</div>
                        <div style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">Above Long Period Average (LPA)
                        </div>
                    </div>

                    <div class="glass-panel" style="padding: 25px; flex: 1;">
                        <h4 style="margin: 0 0 20px 0; font-weight: 400;">Regional Deficit/Surplus</h4>
                        <div style="display: flex; flex-direction: column; gap: 18px;">
                            <div
                                style="display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px;">
                                <span style="color: rgba(255,255,255,0.8);">Northwest India</span>
                                <span style="color: #ff8a65; font-weight: 600;">-12%</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px;">
                                <span style="color: rgba(255,255,255,0.8);">Central India</span>
                                <span style="color: #69f0ae; font-weight: 600;">+18%</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px;">
                                <span style="color: rgba(255,255,255,0.8);">South Peninsula</span>
                                <span style="color: #69f0ae; font-weight: 600;">+8%</span>
                            </div>
                            <div
                                style="display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px;">
                                <span style="color: rgba(255,255,255,0.8);">East & Northeast</span>
                                <span style="color: #ff8a65; font-weight: 600;">-15%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div style="margin-top: auto; width: 100%;">
        {% include 'components/navigation/part_footer.html' %}
    </div>

    <script src="{{ url_for('static', filename='js/core/logic-ui.js') }}?v=1.0.3"></script>
    <script src="{{ url_for('static', filename='js/weather/logic-gauges.js') }}?v=1.0.3"></script>
    <script src="{{ url_for('static', filename='js/weather/logic-charts.js') }}?v=1.0.3"></script>
    <script src="{{ url_for('static', filename='js/safety/logic-map.js') }}?v=1.0.3"></script>
</body>

</html>